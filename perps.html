<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://unpkg.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com; connect-src wss://stream.binance.com:9443 https://api.binance.com; img-src 'self' data:;">
  <title>NX-Perps ‚Äî Perpetuals Trading | nexxore</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>
  <style>
    :root {
      --bg: #08080a;
      --bg-secondary: #0c0c0f;
      --bg-card: #111114;
      --bg-elevated: #161619;
      --text: #ffffff;
      --text-secondary: rgba(255, 255, 255, 0.65);
      --text-muted: rgba(255, 255, 255, 0.4);
      --border: rgba(255, 255, 255, 0.06);
      --border-hover: rgba(255, 255, 255, 0.12);
      --long: #22c55e;
      --long-bg: rgba(34, 197, 94, 0.1);
      --short: #ef4444;
      --short-bg: rgba(239, 68, 68, 0.1);
      --accent: #a855f7;
      --accent-bg: rgba(168, 85, 247, 0.1);
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text-secondary); min-height: 100vh; }

    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 20px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .header-left { display: flex; align-items: center; gap: 24px; }
    .logo { display: flex; align-items: center; gap: 8px; text-decoration: none; }
    .logo-icon { width: 28px; height: 28px; background: linear-gradient(135deg, var(--accent), var(--long)); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.7rem; color: white; }
    .logo-text { font-size: 1rem; font-weight: 700; color: var(--text); }
    .nav-links { display: flex; gap: 4px; }
    .nav-link { padding: 8px 14px; color: var(--text-muted); text-decoration: none; font-size: 0.8rem; font-weight: 500; border-radius: 6px; transition: all 0.2s; }
    .nav-link:hover { color: var(--text-secondary); background: rgba(255,255,255,0.03); }
    .nav-link.active { color: var(--text); background: rgba(255,255,255,0.06); }
    .header-right { display: flex; align-items: center; gap: 10px; }
    .network-badge { display: flex; align-items: center; gap: 6px; padding: 6px 12px; background: var(--long-bg); border: 1px solid rgba(34, 197, 94, 0.2); border-radius: 20px; font-size: 0.7rem; font-weight: 600; color: var(--long); }
    .network-dot { width: 6px; height: 6px; background: var(--long); border-radius: 50%; animation: pulse 2s infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .connect-btn { padding: 8px 18px; background: var(--accent); color: white; border: none; border-radius: 6px; font-size: 0.8rem; font-weight: 600; cursor: pointer; transition: all 0.2s; }
    .connect-btn:hover { background: #9333ea; }

    /* Stats Bar */
    .stats-bar { display: flex; justify-content: center; gap: 8px; padding: 12px 20px; background: var(--bg-secondary); border-bottom: 1px solid var(--border); flex-wrap: wrap; }
    .stat-item { padding: 10px 20px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; text-align: center; min-width: 120px; }
    .stat-label { font-size: 0.6rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; }
    .stat-value { font-size: 0.95rem; font-weight: 700; color: var(--text); font-family: 'JetBrains Mono', monospace; }
    .stat-value.green { color: var(--long); }

    /* Market Tabs */
    .market-tabs { display: flex; gap: 6px; padding: 12px 20px; background: var(--bg); border-bottom: 1px solid var(--border); overflow-x: auto; }
    .market-tab { display: flex; align-items: center; gap: 10px; padding: 10px 16px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; cursor: pointer; transition: all 0.2s; min-width: 150px; }
    .market-tab:hover { border-color: var(--border-hover); background: var(--bg-elevated); }
    .market-tab.active { border-color: var(--accent); background: var(--accent-bg); }
    .market-icon { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.6rem; color: white; }
    .market-icon.eth { background: linear-gradient(135deg, #627eea, #8c9eff); }
    .market-icon.btc { background: linear-gradient(135deg, #f7931a, #ffb347); }
    .market-icon.sol { background: linear-gradient(135deg, #9945ff, #14f195); }
    .market-info { flex: 1; }
    .market-name { font-size: 0.8rem; font-weight: 600; color: var(--text); }
    .market-pair { font-size: 0.65rem; color: var(--text-muted); }
    .market-price { text-align: right; }
    .market-price-value { font-size: 0.8rem; font-weight: 600; color: var(--text); font-family: 'JetBrains Mono', monospace; }
    .market-change { font-size: 0.65rem; font-family: 'JetBrains Mono', monospace; }
    .market-change.up { color: var(--long); }
    .market-change.down { color: var(--short); }

    /* Main Layout - Fixed Grid */
    .main-layout {
      display: grid;
      grid-template-columns: 1fr 340px;
      gap: 0;
      min-height: calc(100vh - 180px);
    }

    /* Chart Section */
    .chart-section { padding: 16px; background: var(--bg); display: flex; flex-direction: column; }
    .chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; flex-wrap: wrap; gap: 12px; }
    .chart-title { display: flex; align-items: center; gap: 12px; }
    .chart-asset-icon { width: 36px; height: 36px; border-radius: 50%; background: linear-gradient(135deg, #627eea, #8c9eff); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.75rem; color: white; }
    .chart-asset-name { font-size: 1.1rem; font-weight: 700; color: var(--text); }
    .chart-asset-pair { font-size: 0.7rem; color: var(--text-muted); }
    .live-price { font-size: 1.6rem; font-weight: 700; color: var(--text); font-family: 'JetBrains Mono', monospace; margin-left: 12px; }
    .price-badge { padding: 4px 10px; border-radius: 4px; font-size: 0.75rem; font-weight: 600; font-family: 'JetBrains Mono', monospace; margin-left: 8px; }
    .price-badge.up { background: var(--long-bg); color: var(--long); }
    .chart-controls { display: flex; gap: 6px; }
    .timeframe-btns { display: flex; gap: 2px; background: var(--bg-card); padding: 3px; border-radius: 6px; }
    .tf-btn { padding: 6px 10px; background: transparent; border: none; color: var(--text-muted); font-size: 0.7rem; font-weight: 500; cursor: pointer; border-radius: 4px; transition: all 0.2s; }
    .tf-btn:hover { color: var(--text-secondary); }
    .tf-btn.active { background: var(--accent); color: white; }

    /* Chart Container */
    .chart-container { background: var(--bg-card); border: 1px solid var(--border); border-radius: 10px; overflow: hidden; height: 450px; position: relative; }
    #tradingChart { width: 100%; height: 100%; }

    /* Chart Stats Row */
    .chart-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 12px; }
    .chart-stat { padding: 12px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; text-align: center; }
    .chart-stat-label { font-size: 0.6rem; color: var(--text-muted); text-transform: uppercase; margin-bottom: 4px; }
    .chart-stat-value { font-size: 0.9rem; font-weight: 600; color: var(--text); font-family: 'JetBrains Mono', monospace; }
    .chart-stat-value.green { color: var(--long); }
    .chart-stat-value.red { color: var(--short); }

    /* Order Panel */
    .order-panel { background: var(--bg-secondary); border-left: 1px solid var(--border); padding: 16px; display: flex; flex-direction: column; }
    .order-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .order-title { font-size: 0.9rem; font-weight: 600; color: var(--text); }
    .order-type-toggle { display: flex; gap: 2px; background: var(--bg-card); padding: 3px; border-radius: 6px; }
    .order-type-btn { padding: 6px 12px; background: transparent; border: none; color: var(--text-muted); font-size: 0.7rem; font-weight: 500; cursor: pointer; border-radius: 4px; transition: all 0.2s; }
    .order-type-btn.active { background: rgba(255,255,255,0.08); color: var(--text); }

    /* Direction Toggle */
    .direction-toggle { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 20px; }
    .direction-btn { padding: 14px 12px; border: 1px solid var(--border); border-radius: 10px; background: transparent; cursor: pointer; transition: all 0.2s; text-align: center; }
    .direction-btn .label { font-size: 0.85rem; font-weight: 600; color: var(--text-muted); display: block; }
    .direction-btn .desc { font-size: 0.65rem; color: var(--text-muted); margin-top: 2px; }
    .direction-btn.long:hover, .direction-btn.long.active { border-color: var(--long); background: var(--long-bg); }
    .direction-btn.long:hover .label, .direction-btn.long.active .label { color: var(--long); }
    .direction-btn.short:hover, .direction-btn.short.active { border-color: var(--short); background: var(--short-bg); }
    .direction-btn.short:hover .label, .direction-btn.short.active .label { color: var(--short); }

    /* Input Group */
    .input-group { margin-bottom: 16px; }
    .input-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
    .input-label { font-size: 0.7rem; color: var(--text-muted); font-weight: 500; }
    .input-max { font-size: 0.65rem; color: var(--accent); cursor: pointer; }
    .input-wrapper { position: relative; }
    .input-field { width: 100%; padding: 12px 50px 12px 14px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-size: 0.95rem; font-family: 'JetBrains Mono', monospace; transition: border-color 0.2s; }
    .input-field:focus { outline: none; border-color: var(--accent); }
    .input-field::placeholder { color: var(--text-muted); }
    .input-suffix { position: absolute; right: 14px; top: 50%; transform: translateY(-50%); font-size: 0.8rem; color: var(--text-muted); }

    /* Leverage */
    .leverage-section { margin-bottom: 20px; }
    .leverage-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    .leverage-value { font-size: 1.1rem; font-weight: 700; color: var(--text); font-family: 'JetBrains Mono', monospace; }
    .leverage-slider { width: 100%; height: 6px; background: var(--bg-card); border-radius: 3px; -webkit-appearance: none; cursor: pointer; }
    .leverage-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 18px; height: 18px; background: var(--accent); border-radius: 50%; cursor: pointer; }
    .leverage-marks { display: flex; justify-content: space-between; margin-top: 6px; }
    .leverage-mark { font-size: 0.6rem; color: var(--text-muted); cursor: pointer; padding: 2px 6px; border-radius: 3px; transition: all 0.2s; }
    .leverage-mark:hover { background: var(--bg-card); color: var(--text); }

    /* Order Summary */
    .order-summary { background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 12px; margin-bottom: 16px; flex: 1; }
    .summary-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid var(--border); }
    .summary-row:last-child { border-bottom: none; }
    .summary-label { font-size: 0.75rem; color: var(--text-muted); }
    .summary-value { font-size: 0.8rem; color: var(--text); font-family: 'JetBrains Mono', monospace; }
    .summary-value.red { color: var(--short); }

    /* Submit Button */
    .submit-btn { width: 100%; padding: 14px; border: none; border-radius: 8px; font-size: 0.9rem; font-weight: 700; cursor: pointer; transition: all 0.2s; text-transform: uppercase; letter-spacing: 0.5px; }
    .submit-btn.long { background: var(--long); color: #000; }
    .submit-btn.long:hover { background: #16a34a; }
    .submit-btn.short { background: var(--short); color: #fff; }
    .submit-btn.short:hover { background: #dc2626; }

    /* Positions Section */
    .positions-section { padding: 20px; background: var(--bg-secondary); border-top: 1px solid var(--border); }
    .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .section-title { font-size: 0.9rem; font-weight: 600; color: var(--text); }
    .section-tabs { display: flex; gap: 2px; background: var(--bg-card); padding: 3px; border-radius: 6px; }
    .section-tab { padding: 6px 14px; background: transparent; border: none; color: var(--text-muted); font-size: 0.7rem; font-weight: 500; cursor: pointer; border-radius: 4px; transition: all 0.2s; }
    .section-tab.active { background: rgba(255,255,255,0.08); color: var(--text); }
    .empty-state { text-align: center; padding: 40px 20px; background: var(--bg-card); border-radius: 10px; }
    .empty-icon { font-size: 2rem; margin-bottom: 12px; opacity: 0.3; }
    .empty-text { color: var(--text-muted); font-size: 0.85rem; }

    /* LP Vaults */
    .vaults-section { padding: 40px 20px; background: var(--bg); border-top: 1px solid var(--border); }
    .vaults-header { text-align: center; margin-bottom: 28px; }
    .vaults-title { font-size: 1.3rem; font-weight: 700; color: var(--text); margin-bottom: 6px; }
    .vaults-desc { font-size: 0.85rem; color: var(--text-muted); }
    .vaults-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; max-width: 1000px; margin: 0 auto; }
    .vault-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; transition: all 0.2s; }
    .vault-card:hover { border-color: var(--border-hover); transform: translateY(-2px); }
    .vault-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; }
    .vault-info { display: flex; align-items: center; gap: 10px; }
    .vault-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.85rem; color: white; }
    .vault-icon.eth { background: linear-gradient(135deg, #627eea, #8c9eff); }
    .vault-icon.usdc { background: linear-gradient(135deg, #2775ca, #4da2ff); }
    .vault-icon.btc { background: linear-gradient(135deg, #f7931a, #ffb347); }
    .vault-name { font-size: 1rem; font-weight: 600; color: var(--text); }
    .vault-type { font-size: 0.7rem; color: var(--text-muted); }
    .vault-apy-label { font-size: 0.6rem; color: var(--text-muted); text-transform: uppercase; }
    .vault-apy-value { font-size: 1.3rem; font-weight: 700; color: var(--long); font-family: 'JetBrains Mono', monospace; }
    .vault-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 16px; }
    .vault-stat { padding: 10px; background: var(--bg-elevated); border-radius: 6px; }
    .vault-stat-label { font-size: 0.6rem; color: var(--text-muted); text-transform: uppercase; margin-bottom: 2px; }
    .vault-stat-value { font-size: 0.85rem; font-weight: 600; color: var(--text); font-family: 'JetBrains Mono', monospace; }
    .vault-btn { width: 100%; padding: 12px; background: transparent; border: 1px solid var(--border); border-radius: 8px; color: var(--text-secondary); font-size: 0.8rem; font-weight: 600; cursor: pointer; transition: all 0.2s; }
    .vault-btn:hover { background: var(--accent); border-color: var(--accent); color: white; }

    /* Responsive */
    @media (max-width: 1024px) {
      .main-layout { grid-template-columns: 1fr; }
      .order-panel { border-left: none; border-top: 1px solid var(--border); }
      .chart-container { height: 380px; }
    }
    @media (max-width: 768px) {
      .header { flex-wrap: wrap; gap: 12px; }
      .stats-bar { padding: 10px; gap: 6px; }
      .stat-item { min-width: 100px; padding: 8px 14px; }
      .chart-stats { grid-template-columns: repeat(2, 1fr); }
      .market-tabs { padding: 10px; }
      .nav-links { display: none; }
      .chart-container { height: 320px; }
      .chart-header { flex-direction: column; align-items: flex-start; }
      .live-price { margin-left: 0; margin-top: 8px; font-size: 1.3rem; }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <a href="index.html" class="logo">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" style="width: 32px; height: 32px;">
          <defs><linearGradient id="logoGrad" x1="0" x2="1"><stop offset="0" stop-color="#a855f7"/><stop offset="1" stop-color="#22c55e"/></linearGradient></defs>
          <g transform="translate(10,15) scale(0.8)"><circle cx="50" cy="40" r="28" stroke="url(#logoGrad)" stroke-width="6" fill="none" opacity="0.95"/><circle cx="78" cy="40" r="28" stroke="url(#logoGrad)" stroke-width="6" fill="none" opacity="0.85"/><circle cx="64" cy="64" r="28" stroke="url(#logoGrad)" stroke-width="6" fill="none" opacity="0.85"/></g>
        </svg>
        <span class="logo-text">nexxore</span>
      </a>
      <nav class="nav-links">
        <a href="index.html" class="nav-link">Home</a>
        <a href="perps.html" class="nav-link active">Perps</a>
        <a href="vaults.html" class="nav-link">Vaults</a>
        <a href="research-agent.html" class="nav-link">Research</a>
      </nav>
    </div>
    <div class="header-right">
      <div class="network-badge">
        <span class="network-dot"></span>
        Arbitrum
      </div>
      <button class="connect-btn">Connect Wallet</button>
    </div>
  </header>

  <!-- Stats Bar -->
  <div class="stats-bar">
    <div class="stat-item">
      <div class="stat-label">Open Interest</div>
      <div class="stat-value">$24.8M</div>
    </div>
    <div class="stat-item">
      <div class="stat-label">24h Volume</div>
      <div class="stat-value">$156.2M</div>
    </div>
    <div class="stat-item">
      <div class="stat-label">LP TVL</div>
      <div class="stat-value green">$42.5M</div>
    </div>
    <div class="stat-item">
      <div class="stat-label">Funding Rate</div>
      <div class="stat-value">0.0082%</div>
    </div>
    <div class="stat-item">
      <div class="stat-label">Max Leverage</div>
      <div class="stat-value">50√ó</div>
    </div>
  </div>

  <!-- Market Tabs -->
  <div class="market-tabs">
    <div class="market-tab active" data-market="ETH">
      <div class="market-icon eth">ETH</div>
      <div class="market-info">
        <div class="market-name">Ethereum</div>
        <div class="market-pair">ETH-USD</div>
      </div>
      <div class="market-price">
        <div class="market-price-value">$4,812.35</div>
        <div class="market-change up">+3.18%</div>
      </div>
    </div>
    <div class="market-tab" data-market="BTC">
      <div class="market-icon btc">BTC</div>
      <div class="market-info">
        <div class="market-name">Bitcoin</div>
        <div class="market-pair">BTC-USD</div>
      </div>
      <div class="market-price">
        <div class="market-price-value">$142,890</div>
        <div class="market-change up">+2.45%</div>
      </div>
    </div>
    <div class="market-tab" data-market="SOL">
      <div class="market-icon sol">SOL</div>
      <div class="market-info">
        <div class="market-name">Solana</div>
        <div class="market-pair">SOL-USD</div>
      </div>
      <div class="market-price">
        <div class="market-price-value">$312.78</div>
        <div class="market-change up">+1.56%</div>
      </div>
    </div>
  </div>

  <!-- Main Layout -->
  <div class="main-layout">
    <!-- Chart Section -->
    <div class="chart-section">
      <div class="chart-header">
        <div class="chart-title">
          <div class="chart-asset-icon">ETH</div>
          <div>
            <div class="chart-asset-name">Ethereum</div>
            <div class="chart-asset-pair">Perpetual / USDC</div>
          </div>
          <span class="live-price" id="livePrice">$4,812.35</span>
          <span class="price-badge up">+3.18%</span>
        </div>
        <div class="chart-controls">
          <div class="timeframe-btns">
            <button class="tf-btn">1m</button>
            <button class="tf-btn">5m</button>
            <button class="tf-btn">15m</button>
            <button class="tf-btn active">1H</button>
            <button class="tf-btn">4H</button>
            <button class="tf-btn">1D</button>
          </div>
        </div>
      </div>

      <div class="chart-container">
        <div id="tradingChart">
          <div class="chart-loading" style="display:flex;align-items:center;justify-content:center;height:100%;color:var(--text-muted);font-size:0.85rem;">Loading chart...</div>
        </div>
      </div>

      <div class="chart-stats">
        <div class="chart-stat">
          <div class="chart-stat-label">24h High</div>
          <div class="chart-stat-value green">$4,923.18</div>
        </div>
        <div class="chart-stat">
          <div class="chart-stat-label">24h Low</div>
          <div class="chart-stat-value red">$4,654.92</div>
        </div>
        <div class="chart-stat">
          <div class="chart-stat-label">Index Price</div>
          <div class="chart-stat-value">$4,811.56</div>
        </div>
        <div class="chart-stat">
          <div class="chart-stat-label">Mark Price</div>
          <div class="chart-stat-value">$4,812.89</div>
        </div>
      </div>
    </div>

    <!-- Order Panel -->
    <div class="order-panel">
      <div class="order-header">
        <span class="order-title">Place Order</span>
        <div class="order-type-toggle">
          <button class="order-type-btn active">Market</button>
          <button class="order-type-btn">Limit</button>
          <button class="order-type-btn">Stop</button>
        </div>
      </div>

      <div class="direction-toggle">
        <button class="direction-btn long active">
          <span class="label">Long</span>
          <span class="desc">Buy / Go Up</span>
        </button>
        <button class="direction-btn short">
          <span class="label">Short</span>
          <span class="desc">Sell / Go Down</span>
        </button>
      </div>

      <div class="input-group">
        <div class="input-header">
          <span class="input-label">Amount</span>
          <span class="input-max">Max: 0.00 USDC</span>
        </div>
        <div class="input-wrapper">
          <input type="text" id="amountInput" name="amount" class="input-field" placeholder="0.00" autocomplete="off">
          <span class="input-suffix">USDC</span>
        </div>
      </div>

      <div class="leverage-section">
        <div class="leverage-header">
          <span class="input-label">Leverage</span>
          <span class="leverage-value" id="leverageDisplay">10√ó</span>
        </div>
        <input type="range" class="leverage-slider" min="1" max="50" value="10" id="leverageSlider">
        <div class="leverage-marks">
          <span class="leverage-mark" data-lev="1">1√ó</span>
          <span class="leverage-mark" data-lev="5">5√ó</span>
          <span class="leverage-mark" data-lev="10">10√ó</span>
          <span class="leverage-mark" data-lev="25">25√ó</span>
          <span class="leverage-mark" data-lev="50">50√ó</span>
        </div>
      </div>

      <div class="order-summary">
        <div class="summary-row">
          <span class="summary-label">Position Size</span>
          <span class="summary-value">0.00 ETH</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Entry Price</span>
          <span class="summary-value">$4,812.35</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Liquidation Price</span>
          <span class="summary-value red">$0.00</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Trading Fee</span>
          <span class="summary-value">0.05%</span>
        </div>
      </div>

      <button class="submit-btn long" id="submitOrder">Long ETH</button>
    </div>
  </div>

  <!-- Positions Section -->
  <div class="positions-section">
    <div class="section-header">
      <h3 class="section-title">Positions & Orders</h3>
      <div class="section-tabs">
        <button class="section-tab active">Positions (0)</button>
        <button class="section-tab">Open Orders (0)</button>
        <button class="section-tab">History</button>
      </div>
    </div>
    <div class="empty-state">
      <div class="empty-icon">üì≠</div>
      <div class="empty-text">No open positions. Connect wallet to start trading.</div>
    </div>
  </div>

  <!-- LP Vaults Section -->
  <div class="vaults-section" id="lp">
    <div class="vaults-header">
      <h2 class="vaults-title">Liquidity Provider Vaults</h2>
      <p class="vaults-desc">Earn yield by providing liquidity to traders.</p>
    </div>

    <div class="vaults-grid">
      <div class="vault-card">
        <div class="vault-header">
          <div class="vault-info">
            <div class="vault-icon eth">ETH</div>
            <div>
              <div class="vault-name">ETH Vault</div>
              <div class="vault-type">Delta-Neutral LP</div>
            </div>
          </div>
          <div>
            <div class="vault-apy-label">APY</div>
            <div class="vault-apy-value">18.4%</div>
          </div>
        </div>
        <div class="vault-stats">
          <div class="vault-stat">
            <div class="vault-stat-label">TVL</div>
            <div class="vault-stat-value">$18.2M</div>
          </div>
          <div class="vault-stat">
            <div class="vault-stat-label">Utilization</div>
            <div class="vault-stat-value">72%</div>
          </div>
        </div>
        <button class="vault-btn">Deposit ETH</button>
      </div>

      <div class="vault-card">
        <div class="vault-header">
          <div class="vault-info">
            <div class="vault-icon usdc">USDC</div>
            <div>
              <div class="vault-name">USDC Vault</div>
              <div class="vault-type">Stable LP</div>
            </div>
          </div>
          <div>
            <div class="vault-apy-label">APY</div>
            <div class="vault-apy-value">14.6%</div>
          </div>
        </div>
        <div class="vault-stats">
          <div class="vault-stat">
            <div class="vault-stat-label">TVL</div>
            <div class="vault-stat-value">$15.8M</div>
          </div>
          <div class="vault-stat">
            <div class="vault-stat-label">Utilization</div>
            <div class="vault-stat-value">68%</div>
          </div>
        </div>
        <button class="vault-btn">Deposit USDC</button>
      </div>

      <div class="vault-card">
        <div class="vault-header">
          <div class="vault-info">
            <div class="vault-icon btc">BTC</div>
            <div>
              <div class="vault-name">BTC Vault</div>
              <div class="vault-type">Delta-Neutral LP</div>
            </div>
          </div>
          <div>
            <div class="vault-apy-label">APY</div>
            <div class="vault-apy-value">15.2%</div>
          </div>
        </div>
        <div class="vault-stats">
          <div class="vault-stat">
            <div class="vault-stat-label">TVL</div>
            <div class="vault-stat-value">$8.5M</div>
          </div>
          <div class="vault-stat">
            <div class="vault-stat-label">Utilization</div>
            <div class="vault-stat-value">58%</div>
          </div>
        </div>
        <button class="vault-btn">Deposit BTC</button>
      </div>
    </div>
  </div>

  <script>
    // Initialize Chart
    function initChart() {
      const chartContainer = document.getElementById('tradingChart');
      if (!chartContainer) {
        console.error('Chart container not found');
        return;
      }
      
      // Check if LightweightCharts is available
      if (typeof LightweightCharts === 'undefined') {
        console.error('LightweightCharts library not loaded');
        chartContainer.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100%;color:#ef4444;font-size:0.85rem;">Chart library failed to load</div>';
        return;
      }
      
      // Clear loading message
      chartContainer.innerHTML = '';
      
      // Get actual dimensions from parent container
      const parentContainer = chartContainer.parentElement;
      const width = parentContainer ? parentContainer.clientWidth - 2 : 800;
      const height = 448;
      
      console.log('Creating chart with dimensions:', width, 'x', height);
      
      const chart = LightweightCharts.createChart(chartContainer, {
        width: width,
        height: height,
        layout: { background: { type: 'solid', color: '#111114' }, textColor: 'rgba(255,255,255,0.6)' },
        grid: { vertLines: { color: 'rgba(255,255,255,0.05)' }, horzLines: { color: 'rgba(255,255,255,0.05)' } },
        crosshair: { mode: LightweightCharts.CrosshairMode.Normal },
        rightPriceScale: { borderColor: 'rgba(255,255,255,0.1)', scaleMargins: { top: 0.1, bottom: 0.2 } },
        timeScale: { borderColor: 'rgba(255,255,255,0.1)', timeVisible: true, secondsVisible: false },
      });

      const candleSeries = chart.addCandlestickSeries({
        upColor: '#22c55e', downColor: '#ef4444',
        borderUpColor: '#22c55e', borderDownColor: '#ef4444',
        wickUpColor: '#22c55e', wickDownColor: '#ef4444',
      });

      // Generate data with proper timestamps - ETH price ~$4,800 for Jan 2026
      const data = [];
      const now = Math.floor(Date.now() / 1000);
      let time = now - 150 * 3600;
      let price = 4650; // Starting price that trends up to current
      
      for (let i = 0; i < 150; i++) {
        // Add slight upward bias to reach current price
        const trend = (4812 - 4650) / 150;
        const volatility = (Math.random() - 0.48) * 0.025; // Slight upward bias
        const change = price * volatility + trend;
        const open = price, close = price + change;
        const high = Math.max(open, close) * (1 + Math.random() * 0.006);
        const low = Math.min(open, close) * (1 - Math.random() * 0.006);
        const roundedTime = Math.floor(time);
        
        data.push({ 
          time: roundedTime, 
          open: parseFloat(open.toFixed(2)), 
          high: parseFloat(high.toFixed(2)), 
          low: parseFloat(low.toFixed(2)), 
          close: parseFloat(close.toFixed(2)) 
        });
        
        time += 3600;
        price = close;
      }
      
      candleSeries.setData(data);
      chart.timeScale().fitContent();
      
      // Update live price display
      if (data.length > 0) {
        const lastPrice = data[data.length - 1].close;
        const priceEl = document.getElementById('livePrice');
        if (priceEl) priceEl.textContent = '$' + lastPrice.toFixed(2);
      }

      // Resize handler
      const resizeChart = () => {
        const parentContainer = chartContainer.parentElement;
        const newWidth = parentContainer ? parentContainer.clientWidth - 2 : 800;
        const newHeight = 448;
        chart.applyOptions({ width: newWidth, height: newHeight });
      };
      window.addEventListener('resize', resizeChart);
      
      // Initial resize after a small delay to ensure DOM is ready
      setTimeout(resizeChart, 100);
      setTimeout(resizeChart, 500);
      
      console.log('‚úÖ Chart initialized successfully');
    }
    
    // Initialize chart when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initChart);
    } else {
      initChart();
    }

    // Leverage slider
    const leverageSlider = document.getElementById('leverageSlider');
    const leverageDisplay = document.getElementById('leverageDisplay');
    if (leverageSlider) {
      leverageSlider.addEventListener('input', function() { leverageDisplay.textContent = this.value + '√ó'; });
    }
    document.querySelectorAll('.leverage-mark').forEach(mark => {
      mark.addEventListener('click', function() {
        leverageSlider.value = this.dataset.lev;
        leverageDisplay.textContent = this.dataset.lev + '√ó';
      });
    });

    // Direction toggle
    document.querySelectorAll('.direction-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.direction-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        const submitBtn = document.getElementById('submitOrder');
        if (this.classList.contains('long')) {
          submitBtn.className = 'submit-btn long'; submitBtn.textContent = 'Long ETH';
        } else {
          submitBtn.className = 'submit-btn short'; submitBtn.textContent = 'Short ETH';
        }
      });
    });

    // Tab handlers
    document.querySelectorAll('.market-tab').forEach(tab => {
      tab.addEventListener('click', function() {
        document.querySelectorAll('.market-tab').forEach(t => t.classList.remove('active'));
        this.classList.add('active');
      });
    });
    document.querySelectorAll('.tf-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.tf-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
      });
    });
    document.querySelectorAll('.order-type-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.order-type-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
      });
    });
    document.querySelectorAll('.section-tab').forEach(tab => {
      tab.addEventListener('click', function() {
        document.querySelectorAll('.section-tab').forEach(t => t.classList.remove('active'));
        this.classList.add('active');
      });
    });

    // ===== LIVE BINANCE PRICE FEEDS =====
    const priceData = {
      ETH: { price: 0, change: 0, high: 0, low: 0, prevPrice: 0 },
      BTC: { price: 0, change: 0, high: 0, low: 0, prevPrice: 0 },
      SOL: { price: 0, change: 0, high: 0, low: 0, prevPrice: 0 }
    };
    
    let wsConnected = false;
    
    // Format price with commas
    function formatPrice(price, decimals = 2) {
      if (!price || isNaN(price)) return '$0.00';
      if (price >= 1000) {
        return '$' + price.toLocaleString('en-US', { minimumFractionDigits: decimals, maximumFractionDigits: decimals });
      }
      return '$' + price.toFixed(decimals);
    }
    
    // Update market tab UI
    function updateMarketTab(symbol, data) {
      const tab = document.querySelector(`.market-tab[data-market="${symbol}"]`);
      if (!tab) { console.log('Tab not found for', symbol); return; }
      
      const priceEl = tab.querySelector('.market-price-value');
      const changeEl = tab.querySelector('.market-change');
      
      if (priceEl && data.price > 0) {
        const decimals = symbol === 'BTC' ? 0 : 2;
        priceEl.textContent = formatPrice(data.price, decimals);
      }
      
      if (changeEl) {
        const changeStr = data.change >= 0 ? `+${data.change.toFixed(2)}%` : `${data.change.toFixed(2)}%`;
        changeEl.textContent = changeStr;
        changeEl.className = 'market-change ' + (data.change >= 0 ? 'up' : 'down');
      }
    }
    
    // Update main chart header for active market
    function updateChartHeader(symbol, data) {
      const activeTab = document.querySelector('.market-tab.active');
      if (!activeTab || activeTab.dataset.market !== symbol) return;
      if (!data.price || data.price <= 0) return;
      
      const livePrice = document.getElementById('livePrice');
      const priceBadge = document.querySelector('.price-badge');
      const summaryRows = document.querySelectorAll('.order-summary .summary-row');
      
      const decimals = symbol === 'BTC' ? 0 : 2;
      
      if (livePrice) {
        livePrice.textContent = formatPrice(data.price, decimals);
      }
      
      if (priceBadge) {
        const changeStr = data.change >= 0 ? `+${data.change.toFixed(2)}%` : `${data.change.toFixed(2)}%`;
        priceBadge.textContent = changeStr;
        priceBadge.className = 'price-badge ' + (data.change >= 0 ? 'up' : 'down');
      }
      
      // Update entry price in order summary (2nd row)
      if (summaryRows.length >= 2) {
        const entryPriceValue = summaryRows[1].querySelector('.summary-value');
        if (entryPriceValue) {
          entryPriceValue.textContent = formatPrice(data.price, decimals);
        }
      }
      
      // Update chart stats
      const stats = document.querySelectorAll('.chart-stat');
      if (stats.length >= 4 && data.high > 0) {
        stats[0].querySelector('.chart-stat-value').textContent = formatPrice(data.high, decimals);
        stats[1].querySelector('.chart-stat-value').textContent = formatPrice(data.low, decimals);
        stats[2].querySelector('.chart-stat-value').textContent = formatPrice(data.price * 0.9998, decimals);
        stats[3].querySelector('.chart-stat-value').textContent = formatPrice(data.price * 1.0001, decimals);
      }
    }
    
    // Binance WebSocket for real-time prices
    function connectBinanceWS() {
      try {
        const streams = 'ethusdt@ticker/btcusdt@ticker/solusdt@ticker';
        const ws = new WebSocket(`wss://stream.binance.com:9443/stream?streams=${streams}`);
        
        ws.onopen = () => {
          console.log('‚úÖ Binance WebSocket connected');
          wsConnected = true;
        };
        
        ws.onmessage = (event) => {
          try {
            const msg = JSON.parse(event.data);
            if (!msg.data) return;
            
            const ticker = msg.data;
            const symbol = ticker.s.replace('USDT', '');
            
            if (priceData[symbol]) {
              priceData[symbol].prevPrice = priceData[symbol].price;
              priceData[symbol].price = parseFloat(ticker.c);
              priceData[symbol].change = parseFloat(ticker.P);
              priceData[symbol].high = parseFloat(ticker.h);
              priceData[symbol].low = parseFloat(ticker.l);
              
              console.log(`üìä ${symbol}: $${priceData[symbol].price.toFixed(2)} (${priceData[symbol].change.toFixed(2)}%)`);
              
              updateMarketTab(symbol, priceData[symbol]);
              updateChartHeader(symbol, priceData[symbol]);
            }
          } catch (e) {
            console.error('WS parse error:', e);
          }
        };
        
        ws.onerror = (err) => {
          console.error('‚ùå Binance WS error:', err);
          wsConnected = false;
        };
        
        ws.onclose = () => {
          console.log('‚ö†Ô∏è Binance WS closed, reconnecting in 3s...');
          wsConnected = false;
          setTimeout(connectBinanceWS, 3000);
        };
      } catch (e) {
        console.error('WS connection error:', e);
        setTimeout(connectBinanceWS, 5000);
      }
    }
    
    // Fetch 24h stats from Binance REST API (as fallback)
    async function fetchBinanceStats() {
      console.log('üîÑ Fetching Binance REST API...');
      const symbols = ['ETHUSDT', 'BTCUSDT', 'SOLUSDT'];
      
      for (const sym of symbols) {
        try {
          const response = await fetch(`https://api.binance.com/api/v3/ticker/24hr?symbol=${sym}`);
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          
          const data = await response.json();
          const symbol = sym.replace('USDT', '');
          
          priceData[symbol].price = parseFloat(data.lastPrice);
          priceData[symbol].change = parseFloat(data.priceChangePercent);
          priceData[symbol].high = parseFloat(data.highPrice);
          priceData[symbol].low = parseFloat(data.lowPrice);
          
          console.log(`‚úÖ REST ${symbol}: $${priceData[symbol].price.toFixed(2)}`);
          
          updateMarketTab(symbol, priceData[symbol]);
          updateChartHeader(symbol, priceData[symbol]);
        } catch (err) {
          console.error(`‚ùå REST error for ${sym}:`, err.message);
        }
      }
    }
    
    // ===== LIVE PROTOCOL STATS (simulated with realistic variations) =====
    let protocolStats = {
      openInterest: 24800000,
      volume24h: 156200000,
      tvl: 42500000,
      fundingRate: 0.0082
    };
    
    function updateProtocolStats() {
      // Add realistic variations
      protocolStats.openInterest += (Math.random() - 0.48) * 150000;
      protocolStats.volume24h += (Math.random() - 0.3) * 500000;
      protocolStats.tvl += (Math.random() - 0.5) * 50000;
      protocolStats.fundingRate += (Math.random() - 0.5) * 0.0005;
      
      // Keep within bounds
      protocolStats.openInterest = Math.max(20000000, Math.min(35000000, protocolStats.openInterest));
      protocolStats.volume24h = Math.max(100000000, Math.min(250000000, protocolStats.volume24h));
      protocolStats.tvl = Math.max(35000000, Math.min(55000000, protocolStats.tvl));
      protocolStats.fundingRate = Math.max(-0.05, Math.min(0.05, protocolStats.fundingRate));
      
      // Update UI
      const statItems = document.querySelectorAll('.stat-item .stat-value');
      if (statItems.length >= 4) {
        statItems[0].textContent = '$' + (protocolStats.openInterest / 1000000).toFixed(1) + 'M';
        statItems[1].textContent = '$' + (protocolStats.volume24h / 1000000).toFixed(1) + 'M';
        statItems[2].textContent = '$' + (protocolStats.tvl / 1000000).toFixed(1) + 'M';
        statItems[3].textContent = protocolStats.fundingRate.toFixed(4) + '%';
      }
    }
    
    // ===== LIVE VAULT APY UPDATES =====
    let vaultData = {
      eth: { apy: 18.4, tvl: 18200000, util: 72 },
      usdc: { apy: 14.6, tvl: 15800000, util: 68 },
      btc: { apy: 15.2, tvl: 8500000, util: 58 }
    };
    
    function updateVaultStats() {
      // Realistic APY variations based on utilization
      Object.keys(vaultData).forEach(key => {
        const v = vaultData[key];
        v.util += (Math.random() - 0.5) * 2;
        v.util = Math.max(40, Math.min(95, v.util));
        v.apy = 8 + (v.util / 100) * 15 + (Math.random() - 0.5) * 0.5;
        v.tvl += (Math.random() - 0.48) * 100000;
      });
      
      const vaultCards = document.querySelectorAll('.vault-card');
      const vaults = ['eth', 'usdc', 'btc'];
      
      vaultCards.forEach((card, i) => {
        const v = vaultData[vaults[i]];
        if (!v) return;
        
        const apyEl = card.querySelector('.vault-apy-value');
        const stats = card.querySelectorAll('.vault-stat-value');
        
        if (apyEl) apyEl.textContent = v.apy.toFixed(1) + '%';
        if (stats[0]) stats[0].textContent = '$' + (v.tvl / 1000000).toFixed(1) + 'M';
        if (stats[1]) stats[1].textContent = Math.round(v.util) + '%';
      });
    }
    
    // Initialize live feeds
    console.log('üöÄ Initializing price feeds...');
    
    // First fetch via REST API immediately
    fetchBinanceStats();
    
    // Then connect WebSocket for real-time updates
    setTimeout(() => {
      connectBinanceWS();
    }, 1000);
    
    // Fallback: Poll REST API every 10 seconds if WS fails
    setInterval(() => {
      if (!wsConnected) {
        console.log('‚ö†Ô∏è WS not connected, using REST fallback...');
        fetchBinanceStats();
      }
    }, 10000);
    
    // Update protocol stats every 5 seconds
    setInterval(updateProtocolStats, 5000);
    
    // Update vault stats every 10 seconds
    setInterval(updateVaultStats, 10000);
  </script>
</body>
</html>
